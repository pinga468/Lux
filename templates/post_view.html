{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>{{ post.title }}</h2>
  <p>Autor: {{ post.author.name }} · Categoria: {{ post.category.name }}</p>
  <p>{{ post.content }}</p>
  <p>Likes: {{ post.likes }} · Investimento total: R$ {{ post.investment }}</p>

  <form method="POST" style="display:inline">
    <button name="like" type="submit">Curtir</button>
  </form>

  <form method="POST" style="display:inline; margin-left:10px">
    <input name="invest" type="number" min="0" value="0">
    <button name="invest" type="submit">Investir</button>
  </form>

  {% if post.company_id == session.get('company_id') %}
    <a href="{{ url_for('edit_post', post_id=post.id) }}">
      <button style="margin-left:10px;">Editar Post</button>
    </a>
    <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
      <button type="submit" style="background:red; color:white; cursor:pointer; margin-left:10px;">
        Apagar Post
      </button>
    </form>
  {% endif %}
</div>

<hr>

<h3>Comentários</h3>
{% for c in post.comments %}
  <div class="card">
    <p><strong>{{ c.author.name }}</strong> · {{ c.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
    <p>{{ c.content }}</p>

    {% if c.company_id == session.get('company_id') %}
      <form action="{{ url_for('delete_comment', comment_id=c.id) }}" method="POST" style="display:inline;">
        <button type="submit" style="background:red; color:white; cursor:pointer;">Apagar</button>
      </form>
    {% endif %}
  </div>
{% else %}
  <p>Seja o primeiro a comentar.</p>
{% endfor %}

{% if session.get("company_id") %}
  <h4>Adicionar comentário</h4>
  <form method="POST">
    <textarea name="comment" rows="3" required></textarea><br>
    <button type="submit">Comentar</button>
  </form>
{% else %}
  <p><a href="/login">Entre</a> para comentar ou investir.</p>
{% endif %}

{% endblock %}

