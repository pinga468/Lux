{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>{{ post.title }}</h2>
  <p>Autor: {{ post.company.name }} · Categoria: {{ post.category.name }}</p>
  <p>{{ post.content }}</p>
  <p>Likes: {{ likes_count }} · Investimento total: R$ {{ investment_total }}</p>

  <!-- Botão de Like -->
  <form method="POST" style="display:inline">
    <button type="submit" name="like" value="1">Curtir</button>
  </form>

  <!-- Investimento -->
  <form method="POST" style="display:inline; margin-left:10px">
    <input name="invest" type="number" min="0" value="0">
    <button type="submit" name="invest" value="1">Investir</button>
  </form>

  {% if session.get("company_id") %}
    {% set logged_name = session.get("name") %}
    
    {% if logged_name == "Lux" or session["company_id"] == post.company_id %}
      <a href="{{ url_for('edit_post', post_id=post.id) }}">
        <button style="margin-left:10px;">Editar Post</button>
      </a>
      <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
        <button type="submit" style="background:red; color:white; cursor:pointer; margin-left:10px;">
          Apagar Post
        </button>
      </form>
    {% endif %}
  {% endif %}
</div>

<hr>

<h3>Comentários</h3>
{% for c in post.comments %}
  <div class="card">
    <p><strong>{{ c.author.name }}</strong> · {{ c.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
    <p>{{ c.content }}</p>

    {% if session.get("company_id") %}
      {% set logged_name = session.get("name") %}
      {% if logged_name == "Lux" or session["company_id"] == c.company_id %}
        <form action="{{ url_for('delete_comment', comment_id=c.id) }}" method="POST" style="display:inline;">
          <button type="submit" style="background:red; color:white; cursor:pointer;">Apagar</button>
        </form>
      {% endif %}
    {% endif %}
  </div>
{% else %}
  <p>Seja o primeiro a comentar.</p>
{% endfor %}

{% if session.get("company_id") %}
  <h4>Adicionar comentário</h4>
  <form method="POST">
    <textarea name="comment" rows="3" required></textarea><br>
    <button type="submit">Comentar</button>
  </form>
{% else %}
  <p><a href="/login">Entre</a> para comentar ou investir.</p>
{% endif %}

{% endblock %}
